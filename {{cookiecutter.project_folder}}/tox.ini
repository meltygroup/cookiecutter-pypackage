[tox]
envlist = py36,py37,black,pylint,bandit,mypy{% if cookiecutter.has_docs == "y" %},docs{% endif %}
{% if cookiecutter.type == "application" -%}
skipsdist=true
skip_install=true
{%- endif %}

[flake8]
max-line-length = 88

[coverage:run]
branch = True

[coverage:report]
ignore_errors = False
fail_under = 100
exclude_lines =
    pragma: no cover
    def __repr__
    if self\.debug
    raise AssertionError
    raise NotImplementedError
    if 0:
    if __name__ == "__main__":

[testenv]
{% if cookiecutter.type == "application" -%}
deps=-r requirements-dev.txt
# Run pytest with python -m so . is present in PYTHONPATH and no install is needed.
commands = python -m pytest -v --capture=fd --cov-report term-missing --cov={{ cookiecutter.project_slug }} tests
{%- else -%}
extras = dev
commands = pytest -v --capture=fd --cov-report term-missing --cov={envsitepackagesdir}/{{ cookiecutter.project_slug }} tests
{%- endif %}

[testenv:black]
commands = black --diff --check {{ cookiecutter.project_slug }}

[testenv:pylint]
commands = pylint -rn {{ cookiecutter.project_slug }} tests

[testenv:bandit]
commands = bandit -r {{ cookiecutter.project_slug }}

[testenv:mypy]
commands = mypy --ignore-missing-imports {{ cookiecutter.project_slug }} tests

[testenv:flake8]
commands = flake8 {{ cookiecutter.project_slug }} tests

{% if cookiecutter.has_docs == "n" %}#{% endif %}[testenv:docs]
{% if cookiecutter.has_docs == "n" %}#{% endif %}deps = sphinx
{% if cookiecutter.has_docs == "n" %}#{% endif %}commands = sphinx-build -b html docs dist/docs
